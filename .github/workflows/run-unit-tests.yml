name: Run Unit Tests

on: [push]

jobs:
  run-unit-tests:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    env:
      PORT: "3333"
      NEST_PUBLIC_API_BASE_URL: "http://localhost:3333"
      DATABASE_URL: postgresql://docker:docker@localhost:5432/postgre

      JWT_PRIVATE_KEY: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tDQpNSUlFdndJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLa3dnZ1NsQWdFQUFvSUJBUURnejMxcTJxSDRnVmxuDQptbU93aittTXI0MWdqOXZCVlVLSE1QR29hUWxiYi8xTjN4YjY4emthVWNFbkVkMWRPZWZ1akpMYWZFaFpsQ09ODQo2ZXdaVE9pQXE2YVhwcTFyNHBpc1VNZXc1VzRxT3hJUUl5bTdleDNaK0lqZGxMVDJ5Mko0L1k3c0JRTnk5d2NrDQpYN0VCdkxBUGxiUCtIQTJZR3c0ZnFDd0hGRVhCVHlXRXRvNHVvQ25DblpLMi9QZG1wSHF5SnV2WEZWc3BVeUJhDQpydzVIUkVtWlZnbklkWElNc1ZiUk93QlcyZ2lGVjF0UWdOWDQxRk5qMjZvK2tQRlBzdmJKVWFXeFFGYjVLQXRMDQpXWFZiRmNkeEZHMnNaYmFrSGNuTi84TFlxM2xGRXZnT3YxUHZPNWJHcDJEbnl0SjJKVlJDY0MwOXBORWZXY2orDQorV1dLZHBIUkFnTUJBQUVDZ2dFQUJDNE14cTVibVVSQVVuNHgydUt5NE9xZmN3YmkzSmYrelhwL2NMWTNjQldODQpyeU4vS21qd3VkeG9VNWMyS0RabFhUdkROZWZrYkh1c0hQMXNmcHlBMTRKMy8vYXg2OUJvQ2RIZm9sZDJTU1ZNDQpUcm9mZ0VkbnlVMWtCVTdkQ2g1dDNqMHNGMXFwZGk4S2ZjT01NS1YxaHp1Q25tdHVRSU9DN29aU2VWYW1pVit5DQpHT29KM0liQTVmMjhaeGk4NEQ0blpHVHBvUktMeUFLbXRPRnZjbVpVOSsvWHkzNUVvcGdDeFZOVEUvZThMNzRSDQpWQnR6dTd6cnRSTmFvRXJZditTY1lpbGJXV0RrR3p5byt4c2EvZ0FKS2h4TUdCV2xJbExiS2lLUnByMGtMUzYvDQpJQnI5aFBuS2FPa0loTXY4TVZKY01rMVhUbkFwRzdJbllVcnZ6QUdCSlFLQmdRRHplZkFJL3dKQ0ZKbUxzZmJ6DQpoT01KZUJaOW5uRnM5VE5BVWVpdUhjSW56RVFMbmoveDFTWkN5TmpiSy9wVk10S2ZxUkRyVU54M1FDd0FOYzBuDQpkTlV0akNBN0E5cFliVTI1Nnd1RTBNVFdYemIzWGkxUFJpTEorQTZLemJUSmlvNEJ2MUlwNURBaUNRbmFmZHdZDQp1ODZ6U3lRWkRKQUF5MGxKdWVPWFVndmRMd0tCZ1FEc1g4TnlNSEFpMlVxR1prYVpRcGRLZEg3TEJqWStlelJJDQppWm0zdVhKV2dkdUpKMnl3QnNsamNqMGxBWXVhR2VrcFNOQUZlazBjOENHVFpoWHFPOGhFejFjaXUyVGNyTVFYDQpzMWVObXdtWXNPcWRaR1VHN0JmMWtycTEyaTBiakFGcnd3V1VHSWtScThFdUpzeEF2ZEJWRGVkdGhzZXlKOUlHDQpPK3k2cE43QS93S0JnUUNOa3kzOFRTd20rSXVBSzIrSmtvL2lCYTR1UlY5M0YrMUJUVitiUHpxU29iZy9lVGw5DQppWS9CN2NBTFVic3lwMmJKNkNrcWE4NkdtUTM4NFV2MTBYM1VDbE1EZmU0TTFTSUpKWitCRDFRbHd4L1hIekFCDQpsS3JOL2l1V2twNjVRcFBvZUROeW9IbE1rU3psbTZITDBBa1ZRSEF4RUpqN25UbDBZVjd4c29lcmlRS0JnUURzDQpMZWR3MGx0SlJzcERMakErZEo0TWhBZ292Z1UzT3cyTHFRbVIzTmNVL3QybjFsK3dKcWZWR05GbGgzekF0a0VWDQp3aTR3T3ZxUC9wUGQzclBvL21EbCtESTlmdmFSMUlKK2wvRFVpZVAxMEZnc2VhTEVYdVMxdUMyZEJPbnJTMklrDQpGWkllWHNHZWlYb1ZyaWlLUzk2OURZNS9EcHU4TkRPVGpRN0ZrM1VMYXdLQmdRQ2drTkFqWEMrdytVTGFVSkI1DQpmaFptL1ZQN1pselc1NFBpcDdpU25Ia3hlay9lZzM3aVdxNDJyTG5IMmtIUDhoS1FLU0VpM29SZmRaUUZyK0RUDQowcWVhV1VYWk5qaDhCUHR1VE43S0lIUXc5VmNkWTdjMllseEg0cG5FazBGMHoycVhZd3VBNzZJQy9makJ0Z2V5DQpVeVl3SDBYQUI3bFB0L1FnV3JHTG9BN2FBUT09DQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tDQo="
      JWT_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0NCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBNE05OWF0cWgrSUZaWjVwanNJL3ANCmpLK05ZSS9id1ZWQ2h6RHhxR2tKVzIvOVRkOFcrdk01R2xIQkp4SGRYVG5uN295UzJueElXWlFqamVuc0dVem8NCmdLdW1sNmF0YStLWXJGREhzT1Z1S2pzU0VDTXB1M3NkMmZpSTNaUzA5c3RpZVAyTzdBVURjdmNISkYreEFieXcNCkQ1V3ovaHdObUJzT0g2Z3NCeFJGd1U4bGhMYU9McUFwd3AyU3R2ejNacVI2c2licjF4VmJLVk1nV3E4T1IwUkoNCm1WWUp5SFZ5RExGVzBUc0FWdG9JaFZkYlVJRFYrTlJUWTl1cVBwRHhUN0wyeVZHbHNVQlcrU2dMUzFsMVd4WEgNCmNSUnRyR1cycEIzSnpmL0MyS3Q1UlJMNERyOVQ3enVXeHFkZzU4clNkaVZVUW5BdFBhVFJIMW5JL3ZsbGluYVINCjBRSURBUUFCDQotLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0NCg=="
      
      JWT_EXPIRES_IN: "10m"
      JWT_REFRESH_TOKEN_EXPIRES_IN: "7d"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 23
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Generate Prisma Client
        run: pnpm prisma generate

      - name: Run Unit Tests
        run: pnpm run test
